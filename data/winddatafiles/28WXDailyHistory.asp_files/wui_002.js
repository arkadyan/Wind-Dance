(function(a,c){var b={};a.autocomplete=function(d){this.options=c.extend({input:null,select:null,minLength:1,includeRecents:true,includePWS:false,autosubmit:false,isMainSearchBox:false,zipCodeOnly:false,captureFormSubmit:false,onSelect:c.noop,suffix:c.noop,exclude:[],className:""},d?d:{});this.input=c(this.options.input);this.select=c(this.options.select);this.hasSelect=(this.select&&this.select.length>0);this.initialize()};a.autocomplete.prototype.initialize=function(){var d=this.input;var f=this.hasSelect;var e=this.options;if(!d[0]){return}this.input.autocomplete({source:function(h,g){var i=/^\d+$/.test(h.term.substr(0,5));if(e.zipCodeOnly&&!i){g(function(){return false})}else{c.ajax({url:"http://autocomplete.wunderground.com/aq",dataType:"jsonp",jsonp:"cb",data:{query:h.term},success:function(l){if(!l||!l.RESULTS){return}var j=[];if(e.includeRecents){var k=a.autocomplete._config.items;var m=new RegExp("^"+c.ui.autocomplete.escapeRegex(h.term),"i");k=c.grep(k,function(n){return m.test(n.name)});j=j.concat(k)}j=j.concat(l.RESULTS);g(c.map(j,function(q){var n=h.term.length;var o=q.name;var p=q.type;var s;if(!e.includePWS&&p=="pws"){return null}if(c.inArray(p,e.exclude)>=0){return null}if(e.zipCodeOnly){s=o.substr(0,5)}else{if(p=="pws"){s=o.split(",",1)[0]}else{if(p=="recent"){s=o}else{s=o}}}var t=e.suffix(s,q)||"";var r=c.extend(true,{},q,{label:'<span class="ui-autocomplete-term">'+o.substr(0,n)+"</span>"+o.substr(n)+t,value:s});return r}))}})}},search:function(h,i){var g=c(this).autocomplete("option","disabled");if(g){return false}},select:function(g,h){if(h.item){this.value=h.item.zip||h.item.value;if(f){this._updateSelectMenu(h.item.type)}if(e.autosubmit){if(e.isMainSearchBox&&h.item.wmo){window.location="/global/stations/"+h.item.wmo+".html"}else{if(e.isMainSearchBox&&window.SubmitFastForecastSearch){window.SubmitFastForecastSearch()}else{if(h.item.type=="pws"){window.location="/weatherstation/WXDailyHistory.asp?ID="+this.value.toUpperCase()}else{this.form.submit()}}}}e.onSelect(this.value,h.item)}},minLength:e.minLength}).data("autocomplete")._renderMenu=function(i,h){var g=this;var j="";c.each(h,function(l,m){if(m.type!=j){var k=a.autocomplete._config.groupTitles[m.type]||m.type;i.append("<li class='ui-autocomplete-group'>"+k+"</li>");j=m.type}g._renderItem(i,m)})};this.input.autocomplete("widget").addClass(e.className);if(f){this.select.change(this._updateEnabledState);this._updateEnabledState()}if(e.captureFormSubmit){this.captureFormSubmit()}};a.autocomplete.prototype.captureFormSubmit=function(){var d=this.input;if(!this.input[0]){return}var e=c(this.input[0].form);e.submit(function(f){d.autocomplete("search",d.val());f.preventDefault()})};a.autocomplete.prototype._updateEnabledState=function(){var d=this.select.val().toLowerCase();if(d=="weather"||d=="pws"){this.input.autocomplete("option","disabled",false);a.autocomplete.setNative(this.input,false)}else{this.input.autocomplete("option","disabled",true);a.autocomplete.setNative(this.input,true)}};a.autocomplete.prototype._updateSelectMenu=function(d){if(d=="city"){this.select.val("WEATHER")}else{if(d=="pws"){this.select.val("PWS")}}};a.autocomplete.setNative=function(d,e){if(e===false){d.addClass("ui-autocomplete-input").attr({autocomplete:"off",role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"})}else{if(e===true){d.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup")}}};a.autocomplete._config={};a.autocomplete._config.items=[];a.autocomplete._config.groupTitles={};a.autocomplete.addItems=function(d){a.autocomplete._config.items=a.autocomplete._config.items.concat(d)};a.autocomplete.setGroupTitles=function(d){a.autocomplete._config.groupTitles=d};c(document).ready(function(){var d=new a.autocomplete({input:"#wuSearch",select:"#wuSelect",autosubmit:true,isMainSearchBox:true,includePWS:true})})})(wui,jQuery);